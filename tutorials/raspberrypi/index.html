<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.4.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Nils Rottmann">

  
  
  
    
  
  <meta name="description" content="This is a tutorial on how to set up your Raspberry Pi for controlling a mobile robot via ROS.">

  
  <link rel="alternate" hreflang="en-us" href="https://nrottmann.github.io/tutorials/raspberrypi/">

  


  

  
  
  
  <meta name="theme-color" content="hsl(339, 90%, 68%)">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light" disabled>
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark">
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.9ca2b3d7b3201745a8e00b3deeb2e2f6.css">

  

  
  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://nrottmann.github.io/tutorials/raspberrypi/">

  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Nils Rottmann | Homepage">
  <meta property="og:url" content="https://nrottmann.github.io/tutorials/raspberrypi/">
  <meta property="og:title" content="Raspberry Pi Configuration | Nils Rottmann | Homepage">
  <meta property="og:description" content="This is a tutorial on how to set up your Raspberry Pi for controlling a mobile robot via ROS."><meta property="og:image" content="https://nrottmann.github.io/tutorials/raspberrypi/featured.png">
  <meta property="twitter:image" content="https://nrottmann.github.io/tutorials/raspberrypi/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-08-10T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2019-08-10T00:00:00&#43;00:00">
  

  


  





  <title>Raspberry Pi Configuration | Nils Rottmann | Homepage</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="dark">

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Nils Rottmann | Homepage</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#talks"><span>Talks</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#theses"><span>Theses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#tutorials"><span>Tutorials</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#accomplishments"><span>Accomplishments</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#tags"><span>Popular Topics</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  <article class="article" itemscope itemtype="http://schema.org/Article">

  




















  
  


<div class="article-container pt-3">
  <h1 itemprop="name">Raspberry Pi Configuration</h1>

  

  



<meta content="2019-08-10 00:00:00 &#43;0000 UTC" itemprop="datePublished">
<meta content="2019-08-10 00:00:00 &#43;0000 UTC" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    <time>Aug 10, 2019</time>
  </span>
  

  

  

  
  
  

  
  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://nrottmann.github.io/tutorials/raspberrypi/&amp;text=Raspberry%20Pi%20Configuration" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://nrottmann.github.io/tutorials/raspberrypi/&amp;t=Raspberry%20Pi%20Configuration" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Raspberry%20Pi%20Configuration&amp;body=https://nrottmann.github.io/tutorials/raspberrypi/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://nrottmann.github.io/tutorials/raspberrypi/&amp;title=Raspberry%20Pi%20Configuration" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Raspberry%20Pi%20Configuration%20https://nrottmann.github.io/tutorials/raspberrypi/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://nrottmann.github.io/tutorials/raspberrypi/&amp;title=Raspberry%20Pi%20Configuration" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>


  

</div>

  














</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 607px; max-height: 405px;">
  <div style="position: relative">
    <img src="/tutorials/raspberrypi/featured.png" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      

<h1 id="raspberry-pi-for-mobile-robots">Raspberry Pi for Mobile Robots</h1>

<p>This is a tutorial on how to set up your Raspberry Pi for controlling a mobile robot. Therefore, we will use the Robot Operating System (ROS) together with different connection possibilities (e.g. WLAN, Mobile Net, &hellip;).</p>

<p>A complete Image with existing ROS installation and WLAN access point can be found <a href="https://drive.google.com/file/d/14kYuFTbEE-RQ3aikde9BUBpjqiKg_Hy9/view?usp=sharing" target="_blank">here</a>. It has everything installed and configured until including the <a href="#UART">Enable SPI and UART Connection</a> section.</p>

<h2 id="table-of-contents">Table of Contents</h2>

<p><a href="#instalOS">Install Raspberry Pi OS</a> <br/></p>

<p><a href="#Access">Access the Raspberry Pi</a> <br/></p>

<p><a href="#ROS">ROS Configuration</a> <br/></p>

<p><a href="#WLAN">WLAN Configuration</a> <br/></p>

<p><a href="#ExtWLAN">External WLAN Connection</a> <br/></p>

<p><a href="#UART">Enable SPI and UART Connection</a> <br/></p>

<p><a href="#USB">Define static addresses for USB ports</a> <br/></p>

<p><a href="#Web">Mobile Web</a> <br/></p>

<p><a href="#ROSWeb">ROS over Mobile Web</a> <br/></p>

<p><a href="#Video">Video for Linux (V4L) and ROS</a> <br/></p>

<p><a href="#EIGEN">Eigen3 Installation</a> <br/></p>

<h2 id="install-raspberry-pi-os-a-name-instalos-a">Install Raspberry Pi OS <a name="instalOS"></a></h2>

<p>First, we install Raspberry Pi OS onto the Raspberry Pi. There are different Images available (e.g. desktop, Lite) which can be found <a href="https://www.raspberrypi.org/downloads/raspberry-pi-os/" target="_blank">here</a>. We will use the Desktop version (Raspberry Pi Os (32 Bit)). The easiest way is to use the Rapsberry Pi Imager to load the image onto your SD card (e.g. 32 GB). Optional you can download the ZIP folder of your chosen Raspberry OS version and load it onto a Micro SD card with your own software, e.g. the Win32 Disk Manager (Windows), which can be found <a href="https://www.chip.de/downloads/Win32-Disk-Imager_46121030.html" target="_blank">here</a>. Therefore, unpack the downloaded ZIP folder (it contains an .img file of the OS), start the Win32 Disk Manager, choose the .img-file and the right data medium and start writing onto the SD card.</p>

<p float="left" align="middle">
  <img src="./images/WinDisk32.png" width="400 hspace="0" />
</p>

<h2 id="access-the-raspberry-pi-a-name-access-a">Access the Raspberry Pi <a name="Access"></a></h2>

<p>To access the Raspberry Pi for installing required components, we first enable the SSH connection. Therefore, we connect a monitor and a keyboard to the Raspberry Pi, start it and login with the default username and password</p>

<pre><code class="language-shell">username: pi
password: raspberry
</code></pre>

<p>To enable SSH connection, we type</p>

<pre><code class="language-shell">sudo raspi-config
</code></pre>

<p>navigate to Interfacing Options, then to P2 SSH and enable the SSH server option. Now we can connect via SSH, e.g. using <a href="https://www.putty.org/" target="_blank">Putty</a>. Therefore, connect the Raspberry Pi to your local network via ethernet. Probably, your Raspberry Pi has to be registered by your system administrator via its MAC address to get a valid IP. Now we can proceed with the further configurations, but first you might want to change your password by typing</p>

<pre><code class="language-shell">passwd
</code></pre>

<h2 id="ros-configuration-a-name-ros-a">ROS Configuration <a name="ROS"></a></h2>

<p>To operate our mobile robot we will use the Robot Operating System (<a href="https://www.ros.org/" target="_blank">ROS</a>). We start by updating and upgrading our system</p>

<pre><code class="language-shell">sudo apt update
sudo apt upgrade
</code></pre>

<p>We now check the version of our Raspberry OS</p>

<pre><code class="language-shell">cat /etc/os-release
</code></pre>

<p>It will show something similar to</p>

<pre><code class="language-shell">PRETTY_NAME=&quot;Raspbian GNU/Linux 10 (buster)&quot;
NAME=&quot;Raspbian GNU/Linux&quot;
VERSION_ID=&quot;10&quot;
VERSION=&quot;10 (buster)&quot;
VERSION_CODENAME=buster
ID=raspbian
ID_LIKE=debian
HOME_URL=&quot;http://www.raspbian.org/&quot;
SUPPORT_URL=&quot;http://www.raspbian.org/RaspbianForums&quot;
BUG_REPORT_URL=&quot;http://www.raspbian.org/RaspbianBugs&quot;
</code></pre>

<p>As you can see, our version is &ldquo;buster&rdquo;. Hence, we can install the current ROS version Melodic onto our Raspberry Pi. To do so, we will follow <a href="[http://wiki.ros.org/ROSberryPi/Installing%20ROS%20Melodic%20on%20the%20Raspberry%20Pi](http://wiki.ros.org/ROSberryPi/Installing ROS Melodic on the Raspberry Pi)" target="_blank">ROS Installation Tutorial</a> for the Raspberry Pi. We start by installing the repository key</p>

<pre><code class="language-shell">sudo sh -c 'echo &quot;deb http://packages.ros.org/ros/ubuntu $(lsb_release -sc) main&quot; &gt; /etc/apt/sources.list.d/ros-latest.list'
sudo apt-key adv --keyserver hkp://ha.pool.sks-keyservers.net:80 --recv-key C1CF6E31E6BADE8868B172B4F42ED6FBAB17C654
</code></pre>

<p>and updating the system</p>

<pre><code class="language-shell">sudo apt update
sudo apt upgrade
</code></pre>

<p>Now, we install the bootstrap dependencies</p>

<pre><code class="language-shell">sudo apt install -y python-rosdep python-rosinstall-generator python-wstool python-rosinstall build-essential cmake
</code></pre>

<p>We will proceed by downloading required files and building ROS-Melodic. First, we require a catkin workspace</p>

<pre><code class="language-shell">mkdir -p ~/ros_catkin_ws
cd ~/ros_catkin_ws
</code></pre>

<p>to then fetch the core packages (no GUI-tools) and build them</p>

<pre><code class="language-shell">rosinstall_generator ros_comm --rosdistro melodic --deps --wet-only --tar &gt; melodic-ros_comm-wet.rosinstall
wstool init src melodic-ros_comm-wet.rosinstall
</code></pre>

<p>We proceed by resolving the dependencies (that should take a while)</p>

<pre><code class="language-bash">rosdep install -y --from-paths src --ignore-src --rosdistro melodic -r --os=debian:buster
sudo rosdep init
rosdep update
</code></pre>

<p>Now, after downloading the packages and resolving the dependencies, we can start building ROS by invoking catkin_make_isolated. It might be required that you decrease the compilation thread with the -j1 or -j2 option</p>

<pre><code class="language-bash">sudo ./src/catkin/bin/catkin_make_isolated --install -DCMAKE_BUILD_TYPE=Release --install-space /opt/ros/melodic
</code></pre>

<p>Now source the ROS environment and also put it into the ~/.bashrc, such that it get sourced automatically  for every bash session</p>

<pre><code class="language-bash">source /opt/ros/melodic/setup.bash
echo &quot;source /opt/ros/melodic/setup.bash&quot; &gt;&gt; ~/.bashrc
</code></pre>

<p>ROS is now completely set up. If you require additional packages, follow up <a href="http://wiki.ros.org/ROSberryPi/Installing ROS Melodic on the Raspberry Pi#Adding_Released_Packages" target="_blank">this procedure</a>.</p>

<h2 id="wlan-configuration-a-name-wlan-a">WLAN Configuration <a name="WLAN"></a></h2>

<p>In order to be able to access the Raspberry Pi in absence of any local network, we let the Raspberry Pi open a WLAN by itself. We can then easily control and monitor our mobile robot over this network, e.g. by using <a href="https://github.com/ROS-Mobile/ROS-Mobile-Android" target="_blank">ROS-Mobile</a>. First, we install required software</p>

<pre><code class="language-shell">sudo apt install dnsmasq hostapd
</code></pre>

<p>Add network configuration to the default activated DHCP Client Daemon by opening the config file</p>

<pre><code class="language-bash">sudo nano /etc/dhcpcd.conf
</code></pre>

<p>and including</p>

<pre><code>interface wlan0
static ip_address=192.168.1.1/24
</code></pre>

<p>by saving the changes with ctrl+o and returning with ctrl+x. As you can see, we assign our WLAN-Interface a static IP, which might be essential for the use as DHCP- or DNS-Server. Now, we restart the DHCP client daemon</p>

<pre><code class="language-shell">sudo systemctl restart dhcpcd
</code></pre>

<p>Check if both network interfaces are available with</p>

<pre><code class="language-shell">ip l
</code></pre>

<p>It should appear something similar to</p>

<pre><code class="language-shell">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000
    link/ether b8:27:eb:44:ba:d4 brd ff:ff:ff:ff:ff:ff
3: wlan0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DORMANT group default qlen 1000
    link/ether b8:27:eb:11:ef:81 brd ff:ff:ff:ff:ff:ff
</code></pre>

<p>Next, we change the configurations for the DHCP-server and the DNS-cache, which both are included in the &ldquo;dnsmasq&rdquo; file.  We save a copy of the current file as backup and then open the file for adding our configurations</p>

<pre><code class="language-shell">sudo mv /etc/dnsmasq.conf /etc/dnsmasq.conf_alt
sudo nano /etc/dnsmasq.conf
</code></pre>

<p>We add the following lines</p>

<pre><code># DHCP-Server active for wlan0
interface=wlan0

# DHCP-Server non-active for existing network
no-dhcp-interface=eth0

# IPv4-addresses and lease time
dhcp-range=192.168.1.100,192.168.1.200,255.255.255.0,24h

# DNS
dhcp-option=option:dns-server,192.168.1.1
</code></pre>

<p>Save and close again with ctrl+o and ctrl+x. Let us now test our configurations</p>

<pre><code class="language-shell">dnsmasq --test -C /etc/dnsmasq.conf
</code></pre>

<p>Hopefully, it gives back now an &ldquo;OK&rdquo;. Finally, we restart the dnsmasq, checking the status and enabling the autostart mode</p>

<pre><code class="language-shell">sudo systemctl restart dnsmasq
sudo systemctl status dnsmasq
sudo systemctl enable dnsmasq
</code></pre>

<p>By checking the status, the service should be &ldquo;Active&rdquo;. In the last step, we now configure the &ldquo;hostapd&rdquo;. Therefore, we open</p>

<pre><code class="language-shell">sudo nano /etc/hostapd/hostapd.conf
</code></pre>

<p>which should be an empty file. We add the following lines</p>

<pre><code># Interface
interface=wlan0

# WLAN-Configuration
ssid=myRobotWLAN
channel=1
hw_mode=g
ieee80211n=1
ieee80211d=1
country_code=DE
wmm_enabled=1

# WLAN-Encryption
auth_algs=1
wpa=2
wpa_key_mgmt=WPA-PSK
rsn_pairwise=CCMP
wpa_passphrase=12345678
</code></pre>

<p>Our WLAN has now the name myRobotWLAN and the password is &ldquo;12345678&rdquo;. Since this file holds the WLAN password, we should only allow the user root to get access</p>

<pre><code class="language-shell">sudo chmod 600 /etc/hostapd/hostapd.conf
</code></pre>

<p>Lets us now check if the &ldquo;hostapd&rdquo; can be successfully put into operation</p>

<pre><code class="language-shell">sudo hostapd -dd /etc/hostapd/hostapd.conf
</code></pre>

<p>If successfully, it should not go back to command input and show the following two lines somewhere</p>

<pre><code class="language-shell">wlan0: interface state COUNTRY_UPDATE-&gt;ENABLED
wlan0: AP-ENABLED
</code></pre>

<p>If it goes back to command input or puts out error message, multiple error sources are possible. One common mistake is that you did not specify the country in which you operate, such that WLAN in general is disabled. Therefore go to</p>

<pre><code class="language-shell">sudo raspi-config
</code></pre>

<p>and enable the WLAN. To let the &ldquo;hostapd&rdquo; start in the background as daemon we open the default configurations</p>

<pre><code class="language-shell">sudo nano /etc/default/hostapd
</code></pre>

<p>and add</p>

<pre><code>RUN_DAEMON=yes
DAEMON_CONF=&quot;/etc/hostapd/hostapd.conf&quot;
</code></pre>

<p>Finally, we take the &ldquo;hostapd&rdquo; in work with</p>

<pre><code class="language-shell">sudo systemctl unmask hostapd
sudo systemctl start hostapd
sudo systemctl enable hostapd
</code></pre>

<p>We can check if everything is successful by typing</p>

<pre><code class="language-shell">sudo systemctl status hostapd
</code></pre>

<p>where &ldquo;active&rdquo; and &ldquo;loaded&rdquo; should be stated. We can now access the WLAN &ldquo;myRobotWLAN&rdquo; and connect via SSH to our Raspberry Pi.</p>

<p>You can also find the presented tutorial <a href="https://www.elektronik-kompendium.de/sites/raspberry-pi/2002171.htm" target="_blank">here</a> (it is in german).</p>

<h2 id="external-wlan-connection-a-name-extwlan-a">External WLAN Connection<a name="ExtWLAN"></a></h2>

<p>If you want the Raspberry to access an external WLAN instead of open an own one, just open</p>

<pre><code class="language-shell">sudo nano /etc/network/interfaces
</code></pre>

<p>and add the WLAN specification</p>

<pre><code class="language-shell"># External WLAN
allow-hotplug wlan0
iface wlan0 inet manual
wpa-ssid &quot;WLAN-NAME&quot;
wpa-psk &quot;WLAN-PASSWORT&quot;
</code></pre>

<p>Afterwards, restart the interface</p>

<pre><code class="language-shell">sudo ifdown wlan0
sudo ifup wlan0
</code></pre>

<h2 id="enable-spi-and-uart-connection-a-name-uart-a">Enable SPI and UART Connection <a name="UART"></a></h2>

<p>Some sensors might require UART or SPI connections. To enable those connections we can change the boot config file</p>

<pre><code class="language-shell">sudo nano /boot/config.txt
</code></pre>

<p>and add the following lines</p>

<pre><code># This enables devices 0.0 and 0.1
dtparam=spi=on
dtoverlay=spi1-3cs,cs0_pin=16,cs1_pin=12,cs2_pin=6

# Enable UART
enable_uart=1
</code></pre>

<p>In addition, we have to enable serial devices in general by going into the configuration setup</p>

<pre><code class="language-shell">sudo raspi-config
</code></pre>

<p>Go to interfacing options and enable serial connections.</p>

<h2 id="define-static-addresses-for-usb-ports-a-name-usb-a">Define static addresses for USB ports <a name="USB"></a></h2>

<p>You might like to have static addresses for your USB ports, such that you can easily access them within your ROS nodes. To define these static addresses, we add a new file to the udev rules</p>

<pre><code class="language-shell">sudo nano /etc/udev/rules.d/99-usb-serial.rules
</code></pre>

<p>and add there the following lines</p>

<pre><code>SUBSYSTEM==&quot;tty&quot;, KERNELS==&quot;1-1.2&quot;, SYMLINK+=&quot;sensor01&quot;
SUBSYSTEM==&quot;tty&quot;, KERNELS==&quot;1-1.3&quot;, SYMLINK+=&quot;sensor02&quot;
SUBSYSTEM==&quot;tty&quot;, KERNELS==&quot;1-1.4&quot;, SYMLINK+=&quot;sensor03&quot;
SUBSYSTEM==&quot;tty&quot;, KERNELS==&quot;1-1.5&quot;, SYMLINK+=&quot;sensor04&quot;
</code></pre>

<p>That defines for the 4 USB ports of the Raspberry Pi the static addresses sensor01, &hellip;, sensor04. Be sure that the correct quotes for the strings have been used. Below you can see the defined port declaration.</p>

<p float="left" align="middle">
  <img src="./images/USBPorts.png" width="800 hspace="0" />
</p>

<p>The KERNELS might differ in your case, dependent on your hardware settings. To find out your KERNELS for the individual USB ports, plug a USB device into each port (one by one) and check</p>

<pre><code class="language-shell">udevadm info -a -p $(udevadm info -q path -n /dev/ttyACM0)
</code></pre>

<p>Your will receive the current serial connection information and will find something like</p>

<pre><code class="language-shell">...

looking at parent device '/devices/pci0000:00/0000:00:14.0/usb1/1-3/1-3:1.3':
    KERNELS==&quot;1-3:1.3&quot;

...
</code></pre>

<p>where everything before the colon, thus &ldquo;1-3&rdquo;, would be your entry for the KERNELS in the udev rules. To apply the new rules we have to reload them with the udevadm manager as super user</p>

<pre><code class="language-shell">sudo su
sudo udevadm control --reload-rules &amp;&amp; udevadm trigger
exit
</code></pre>

<p>You can check a serial port by connecting a device and try to read from it, e.g.</p>

<pre><code>cat /dev/sensor01
</code></pre>

<h2 id="mobile-web-a-name-web-a">Mobile Web <a name="Web"></a></h2>

<p>To allow the Raspberry Pi to connect to the Mobile Web, we can use the <a href="https://sixfab.com/product/raspberry-pi-base-hat-3g-4g-lte-minipcie-cards/" target="_blank">Raspberry Pi 3G/4G &amp; LTE Base HAT</a> together with a prepaid mobile SIMcard (e.g. Aldi Talk). Follow up <a href="https://sixfab.com/ppp-installer-for-sixfab-shield-hat/" target="_blank">this tutorial</a> to get started. You require your APN, which would be for Aldi Talk</p>

<pre><code>internet.eplus.de
</code></pre>

<p>You can test your internet connection by installing</p>

<pre><code class="language-shell">sudo apt install dnsutils
</code></pre>

<p>and using &ldquo;nslookup&rdquo;</p>

<pre><code class="language-shell">nslookup google.de
</code></pre>

<h2 id="ros-over-mobile-web-a-name-rosweb-a">ROS over Mobile Web <a name="ROSWeb"></a></h2>

<p>To allow ROS connections via the Mobile Web, we require a secure VPN network with one server and multiple clients. The computer on which the server is running should have a static IP address for the internet connection. We assume that the VPN server is hosted on a computer running Linux Ubuntu 18.04. We start by installing OpenVPN and easy-rsa</p>

<pre><code class="language-shell">sudo apt install openvpn
sudo apt install easy-rsa
</code></pre>

<p>Easy-rsa is needed for generating all keys and certificates we require. Therefore, we copy the folder for the key generation to a suitable place</p>

<pre><code class="language-shell">sudo cp -r /usr/share/easy-rsa /etc/openvpn/easy-rsa2
</code></pre>

<p>We now have to adapt the file &ldquo;vars&rdquo; in the easy-rsa2 folder</p>

<pre><code class="language-shell">cd easy-rsa2
sudo nano vars
</code></pre>

<p>Here we have to change the following entries that they fit to out situation</p>

<pre><code>export KEY_COUNTRY=&quot;DE&quot;
export KEY_PROVINCE=&quot;Schleswig-Holstein&quot;
export KEY_CITY=&quot;Luebeck&quot;
export KEY_ORG=&quot;ROB&quot;
export KEY_EMAIL=&quot;info@webmaster&quot;
export KEY_EMAIL=info@webmaster
export KEY_CN=changeme
export KEY_NAME=changeme
export KEY_OU=changeme
export PKCS11_MODULE_PATH=changeme
export PKCS11_PIN=1234
</code></pre>

<p>Also we have to add the line</p>

<pre><code>export KEY_ALTNAMES=&quot;Irgendwas&quot;
</code></pre>

<p>We check now if the folder &ldquo;keys&rdquo; already exists, if not, we add it</p>

<pre><code class="language-shell">sudo mkdir keys
</code></pre>

<p>Next, we change the name of the latest &ldquo;openssl-x.x.x.cnf&rdquo; to &ldquo;openssl.cnf&rdquo;</p>

<pre><code class="language-shell">sudo cp openssl-x.x.x.cnf openssl.cnf
</code></pre>

<p>The above adapted file &ldquo;vars&rdquo; has to be now sourced</p>

<pre><code class="language-shell">source ./vars
</code></pre>

<p>There will be a warning. Now we can generate the master certificate and key</p>

<pre><code class="language-shell">sudo -E ./clean-all
sudo -E ./build-ca
</code></pre>

<p>the &ldquo;dh2048.pem&rdquo; file</p>

<pre><code class="language-shell">sudo -E ./build-dh
</code></pre>

<p>and the certificate and key for the server</p>

<pre><code class="language-shell">sudo -E ./build-key-server server
</code></pre>

<p>Now we can generate the keys and certificates for the different clients</p>

<pre><code class="language-shell">sudo -E ./build-key client1
sudo -E ./build-key client2
sudo -E ./build-key client3
</code></pre>

<p>Finally, we require to generate the Diffie-Hellmann-Parameter</p>

<pre><code class="language-shell">sudo -E ./build-dh
</code></pre>

<p>For the client we need only the .key, the .crt and the ca.crt files. We can pack them and send them to our clients</p>

<pre><code class="language-shell">tar -cf client1.tar client1.key client1.crt ca.crt
</code></pre>

<p>We now need to define a configuration file for the server, &ldquo;server.conf&rdquo;, with</p>

<pre><code class="language-shell">cd /etc/openvpn
sudo nano server.conf
</code></pre>

<p>Add into this file the following lines</p>

<pre><code>dev tun
proto udp
port 1194
ca /etc/openvpn/easy-rsa2/keys/ca.crt
cert /etc/openvpn/easy-rsa2/keys/server.crt
key /etc/openvpn/easy-rsa2/keys/server.key  # This file should be kept secret
dh /etc/openvpn/easy-rsa2/keys/dh2048.pem
topology subnet
server 10.8.0.0 255.255.255.0
client-config-dir ccd
client-to-client
keepalive 1 10
cipher AES-256-CBC   # AES
comp-lzo no
persist-key
persist-tun
status openvpn-status.log
verb 4
</code></pre>

<p>We add also a directory &ldquo;ccd&rdquo; (client-config-directory) and add client files to define static IP addresses for each client</p>

<pre><code class="language-shell">sudo mkdir ccd
cd ccd
sudo nano client1
</code></pre>

<p>where we add the following line</p>

<pre><code>ifconfig-push 10.8.0.2 255.255.255.0
</code></pre>

<p>Here, the IP is the static IP attached to the client. Now we can run our server using</p>

<pre><code class="language-shell">sudo openvpn server.conf
</code></pre>

<h4 id="cellphone-as-client-android">Cellphone as Client (Android)</h4>

<p>We first generate a file named &ldquo;client.ovpn&rdquo;</p>

<pre><code class="language-shell">cd  ~
nano client.ovpn
</code></pre>

<p>and add the following lines</p>

<pre><code>client
proto udp
dev tun
remote server.ip 1194
resolv-retry infinite
persist-key
persist-tun
ca ca.crt
cert client1.crt
key client1.key
remote-cert-tls server
cipher AES-256-CBC
comp-lzo no
verb 3
</code></pre>

<p>where we insert the correct static server IP. We then copy this file together with the &ldquo;client1.key&rdquo;, &ldquo;client1.crt&rdquo;, &ldquo;ca.crt&rdquo; files to a chosen folder on our mobile phone. Then, download the &ldquo;OpenVPN Connect&rdquo; App and find the &ldquo;client.ovpn&rdquo; file. Now you can simply press the connect button and the connection to your server (if the server is running) should be established.</p>

<h4 id="raspberry-pi-as-client">Raspberry Pi as Client</h4>

<p>Install openvpn</p>

<pre><code class="language-shell">sudo apt install openvpn
</code></pre>

<p>Generate a file called &ldquo;client.conf&rdquo;</p>

<pre><code class="language-shell">cd /etc/openvpn
sudo nano client.conf
</code></pre>

<p>and add the following lines</p>

<pre><code>client
proto udp
dev tun
remote server.ip 1194
resolv-retry infinite
persist-key
persist-tun
ca ca.crt
cert client1.crt
key client1.key
remote-cert-tls server
cipher AES-256-CBC
comp-lzo no
verb 3
</code></pre>

<p>where we insert the correct static server IP. Put the &ldquo;client1.key&rdquo;, &ldquo;client1.crt&rdquo;, &ldquo;ca.crt&rdquo; files into the &ldquo;/etc/openvpn&rdquo; folder. You can start now the connection using</p>

<pre><code class="language-shell">sudo openvpn client.conf
</code></pre>

<h4 id="test-the-system">Test the System</h4>

<p>In order to check if our system works for sending ROS messages, we can use a simple talker node. Therefore, download the <a href="https://drive.google.com/drive/folders/1PC52Sx3O7vkILSU1u4OL9ehUbs8QH7KW?usp=sharing" target="_blank">sample code</a> onto one of your clients which consist of a ROS package, which should be placed into the &ldquo;src&rdquo; folder of a catkin workspace. Thus, we first create such a workspace and &ldquo;src&rdquo; folder</p>

<pre><code>cd ~
sudo mkdir -p catkin_ws/src
</code></pre>

<p>Now put the &ldquo;connection_test&rdquo; package into this folder and compile</p>

<pre><code>cd ~/catkin_ws
catkin_make
</code></pre>

<p>The accompanied bash script will set all required environmental variables and start our test launch file. Therefore, put this into your home folder, make it executable and start it. But before, adjust the IP according to your system, (e.g. for client1 it might be the 10.8.0.2, depending which static IPs you assigned)</p>

<pre><code>./startConnection.sh
</code></pre>

<p>Now, we can try to listen to the chatter topic from a different client or from the server. Be aware, that you also have to set the correct IP address onto these system.</p>

<h2 id="video-for-linux-v4l-and-ros-a-name-video-a">Video for Linux (V4L) and ROS<a name="Video"></a></h2>

<p>Let&rsquo;s assume you have a V4L compatible camera which you can simply plug in to one of the USB ports of the Raspberry Pi. You can check whether the camera is correctly recognized by typing</p>

<pre><code class="language-shell">ls /dev/video*
</code></pre>

<p>You should get some video devices as return, e.g. /dev/video0 or /dev/video1. The different devices stand for different output formats of the connected camera, e.g. MJPG or H.264. In order to check this as well as supported framerates and framesizes, type</p>

<pre><code class="language-shell">v4l2-ctl --device=0 --list-formats-ext
</code></pre>

<h4 id="streaming-via-vlc">Streaming via VLC</h4>

<p>We can now feed forward the video stream via a VLC server installing first VLC</p>

<pre><code class="language-shell">sudo apt-get install vlc
</code></pre>

<p>and then using</p>

<pre><code class="language-shell">cvlc -vvv v4l2:///dev/video0 --sout '#rtp{sdp=rtsp://:8554/}' :demux=h264
</code></pre>

<p>To get access to the stream, we can now open the VLC media player on any other device connected to the same network as the Raspberry Pi, open the Tab &ldquo;media&rdquo;, open &ldquo;open network stream&rdquo; and insert</p>

<pre><code>rtsp://141.83.19.37:8554/
</code></pre>

<h4 id="video-to-ros">Video to ROS</h4>

<p>In order to feed forward video data to the ROS system, we can use &ldquo;usb_cam&rdquo; together with &ldquo;compressed_image_transport&rdquo;. Unfortunately, ROS currently does not support the H.264 format such that we have to use the MJPG compression format. Start now by installing the required nodes following up <a href="http://wiki.ros.org/ROSberryPi/Installing ROS Melodic on the Raspberry Pi#Adding_Released_Packages" target="_blank">this procedure</a></p>

<pre><code class="language-shell">cd ~/ros_catkin_ws
rosinstall_generator usb_cam compressed_image_transport --rosdistro melodic --deps --wet-only --tar &gt; melodic-custom_ros.rosinstall
wstool merge -t src melodic-custom_ros.rosinstall
wstool update -t src
rosdep install --from-paths src --ignore-src --rosdistro melodic -y -r --os=debian:buster
sudo ./src/catkin/bin/catkin_make_isolated --install -DCMAKE_BUILD_TYPE=Release --install-space /opt/ros/melodic -j1
</code></pre>

<p>After installing everything, we can then create a launch file</p>

<pre><code class="language-shell">&lt;launch&gt;
  &lt;node name=&quot;usb_cam&quot; pkg=&quot;usb_cam&quot; type=&quot;usb_cam_node&quot; output=&quot;screen&quot; &gt;
    &lt;param name=&quot;video_device&quot; value=&quot;/dev/video0&quot; /&gt;
    &lt;param name=&quot;image_width&quot; value=&quot;640&quot; /&gt;
    &lt;param name=&quot;image_height&quot; value=&quot;480&quot; /&gt;
    &lt;param name=&quot;pixel_format&quot; value=&quot;yuyv&quot; /&gt;
    &lt;param name=&quot;camera_frame_id&quot; value=&quot;usb_cam&quot; /&gt;
    &lt;param name=&quot;io_method&quot; value=&quot;mmap&quot;/&gt;
  &lt;/node&gt;
&lt;/launch&gt;
</code></pre>

<p>filling up the correct parameters which can be detected with above mentioned &ldquo;cvlc&rdquo;.</p>

<h2 id="eigen3-installation-a-name-eigen-a">Eigen3 Installation <a name="EIGEN"></a></h2>

<p>Your might want to use Eigen3 as math library for some ROS nodes (e.g. a Kalman Filter). To install the Eigen3 package &hellip;</p>

    </div>

    


    

<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/mobile-robotics/">Mobile Robotics</a>
  
  <a class="badge badge-light" href="/tags/ros/">ROS</a>
  
</div>



    
      








  





  
  
  
    
  
  
  <div class="media author-card" itemscope itemtype="http://schema.org/Person">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_hu29cb5f75b1815f628d724f2a7ae7fa45_3232894_250x250_fill_lanczos_center_2.png" itemprop="image" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title" itemprop="name"><a href="https://nrottmann.github.io/">Nils Rottmann</a></h5>
      <h6 class="card-subtitle">Research Scientist for Autonomous and Intelligent Systems</h6>
      <p class="card-text" itemprop="description">With January 2018, Nils Rottmann is a PhD student and research scientist at the Institute for Robotics and Cognitive Systems at the University of Luebeck. In his doctoral study, with the title “Smart Sensor, Navigation and Learning Strategies for low-cost lawn care Systems”, he develops low-cost sensor systems and investigates probabilistic learning and modeling approaches. His research addresses the challenges of learning adaptive control strategies from few and sparse data and to predict and plan complex motions in dynamical systems. He holds a master’s degree in Theoretical Mechanical Engineering from the Hamburg University of Technology, Germany. Nils Rottmann graduated with honors in December 2017 with a thesis entitled „Geometric Control and Stochastic Trajectory Planning for Underwater Robotic Systems“.</p>
      <ul class="network-icon" aria-hidden="true">
        
          
          
          
            
          
          
          
          
          
          <li>
            <a itemprop="sameAs" href="mailto:rottmann1990[at]gmail[dot]com" >
              <i class="fas fa-envelope"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://twitter.com/rottmann_nils" target="_blank" rel="noopener">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://scholar.google.com/citations?hl=en&amp;view_op=list_works&amp;gmla=AJsN-F5kQjB_tXPL5D1XWu4h4WoQjIgk0IgPS3RaddrVlH_8YlGlkYM9_tlhULLGgdoObbOXj23tUf5J5QIymN4XDTiu3zCqnJcUST37egIdtykkXpJkWJc&amp;user=6tvmhbQAAAAJ" target="_blank" rel="noopener">
              <i class="ai ai-google-scholar"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://github.com/NRottmann" target="_blank" rel="noopener">
              <i class="fab fa-github"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://drive.google.com/file/d/1l1Ypp5BG7fS-l-86Q0bRE-Fqvl8pgRFX/view?usp=sharing" target="_blank" rel="noopener">
              <i class="ai ai-cv"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>



      
      
      <div class="article-widget">
        <div class="hr-light"></div>
        <h3>Related</h3>
        <ul>
          
          <li><a href="/tutorials/rosgazebo/">ROS-Gazebo Tutorial</a></li>
          
          <li><a href="/project/legorobots/">Our Common Future (expired)</a></li>
          
          <li><a href="/project/mirana/">MIRANA (expired)</a></li>
          
          <li><a href="/thesis/alexanderosiik/">Trajectory planning for mobile robots for working area complete coverage under high uncertainty</a></li>
          
        </ul>
      </div>
      
    

    

    


  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/r.min.js"></script>
        
      

      
      
    

    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.16bbb3750feb7244c9bc409a5a4fe678.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
